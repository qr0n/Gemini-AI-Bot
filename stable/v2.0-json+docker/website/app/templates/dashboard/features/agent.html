{% extends "base.html" %}

{% block title %}Agent Module - Nugget Tech{% endblock %}
{% block page_title %}Agent Module{% endblock %}

{% block content %}
<div class="card-grid">
    <div class="card">
        <h2>Agent Configuration</h2>
        <p class="description">Configure the agent's core behavior and capabilities</p>
        
        <form class="settings-form">
            <div class="input-group">
                <label for="agent_mode">Agent Mode</label>
                <select id="agent_mode" name="agent_mode" class="input select">
                    <option value="assistant">Assistant (Q&A)</option>
                    <option value="proactive">Proactive (Suggestions)</option>
                    <option value="autonomous">Autonomous (Self-directed)</option>
                </select>
                <span class="hint">How the agent interacts with users</span>
            </div>

            <div class="input-group">
                <label for="personality">Personality Type</label>
                <select id="personality" name="personality" class="input select">
                    <option value="professional">Professional</option>
                    <option value="friendly">Friendly</option>
                    <option value="technical">Technical</option>
                    <option value="creative">Creative</option>
                </select>
                <span class="hint">Agent's communication style</span>
            </div>

            <div class="input-group">
                <label class="switch-label">
                    <input type="checkbox" id="learn_from_interactions" name="learn_from_interactions" class="switch-input">
                    <span class="switch"></span>
                    Learn from Interactions
                </label>
                <span class="hint">Allow agent to adapt based on user interactions</span>
            </div>
        </form>
    </div>

    <div class="card">
        <h2>Skills & Capabilities</h2>
        <p class="description">Enable or disable agent capabilities</p>

        <form class="settings-form">
            <div class="input-group">
                <label>Core Skills</label>
                <div class="checkbox-grid">
                    <label class="checkbox-label">
                        <input type="checkbox" name="skills" value="code_analysis" checked>
                        Code Analysis
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="skills" value="debugging" checked>
                        Debugging
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="skills" value="documentation" checked>
                        Documentation
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="skills" value="testing" checked>
                        Testing
                    </label>
                </div>
            </div>

            <div class="input-group">
                <label>Advanced Features</label>
                <div class="checkbox-grid">
                    <label class="checkbox-label">
                        <input type="checkbox" name="advanced_features" value="code_generation">
                        Code Generation
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="advanced_features" value="refactoring">
                        Refactoring
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="advanced_features" value="optimization">
                        Optimization
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" name="advanced_features" value="security_analysis">
                        Security Analysis
                    </label>
                </div>
            </div>
        </form>
    </div>

    <div class="card">
        <h2>Learning & Memory</h2>
        <p class="description">Configure how the agent learns and retains information</p>

        <form class="settings-form">
            <div class="input-group">
                <label for="memory_capacity">Memory Capacity (MB)</label>
                <input type="number" id="memory_capacity" name="memory_capacity" class="input" value="512" min="128" max="2048">
                <span class="hint">Maximum memory storage for learned information</span>
            </div>

            <div class="input-group">
                <label for="knowledge_update_interval">Knowledge Update Interval (hours)</label>
                <input type="number" id="knowledge_update_interval" name="knowledge_update_interval" class="input" value="24" min="1" max="168">
                <span class="hint">How often to update the knowledge base</span>
            </div>

            <div class="input-group">
                <label class="switch-label">
                    <input type="checkbox" id="persistent_memory" name="persistent_memory" class="switch-input" checked>
                    <span class="switch"></span>
                    Persistent Memory
                </label>
                <span class="hint">Retain learned information between sessions</span>
            </div>
        </form>
    </div>
</div>

<div class="actions-bar">
    <button type="button" class="button secondary-button">Reset to Defaults</button>
    <button type="button" class="button primary-button">Save Changes</button>
</div>
{% endblock %}

{% block scripts %}
<script>
// Save changes
document.querySelector('.primary-button').addEventListener('click', async () => {
    const formData = {
        skills: Array.from(document.querySelectorAll('input[name="skills"]:checked'))
            .map(cb => cb.value),
        advanced_features: Array.from(document.querySelectorAll('input[name="advanced_features"]:checked'))
            .map(cb => cb.value)
    };
    
    document.querySelectorAll('.settings-form input:not([name="skills"]):not([name="advanced_features"]), .settings-form select').forEach(input => {
        formData[input.name] = input.type === 'checkbox' ? input.checked :
                              input.type === 'number' ? Number(input.value) :
                              input.value;
    });
    
    try {
        const response = await fetch('/api/settings/agent', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
        });
        
        if (response.ok) {
            showToast('Settings saved successfully');
        } else {
            throw new Error('Failed to save settings');
        }
    } catch (error) {
        showToast('Error saving settings', 'error');
    }
});

// Reset to defaults
document.querySelector('.secondary-button').addEventListener('click', async () => {
    if (confirm('Are you sure you want to reset all agent settings to their defaults?')) {
        try {
            const response = await fetch('/api/settings/agent/reset', {
                method: 'POST'
            });
            
            if (response.ok) {
                const defaults = await response.json();
                
                // Reset checkboxes
                document.querySelectorAll('input[name="skills"], input[name="advanced_features"]').forEach(cb => {
                    const category = cb.getAttribute('name');
                    cb.checked = defaults[category].includes(cb.value);
                });
                
                // Reset other inputs
                Object.entries(defaults).forEach(([key, value]) => {
                    if (!['skills', 'advanced_features'].includes(key)) {
                        const input = document.querySelector(`[name="${key}"]`);
                        if (input) {
                            if (input.type === 'checkbox') {
                                input.checked = value;
                            } else {
                                input.value = value;
                            }
                        }
                    }
                });
                
                showToast('Settings reset to defaults');
            } else {
                throw new Error('Failed to reset settings');
            }
        } catch (error) {
            showToast('Error resetting settings', 'error');
        }
    }
});
</script>
{% endblock %}
